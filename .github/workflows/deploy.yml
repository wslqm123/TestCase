# .github/workflows/deploy.yml
name: Build and Deploy Test Cases

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Build Test Case Files ğŸ”¨
        run: |
          LATEST_VERSION_DIR=$(ls -d cases/*/ | sort -V | tail -n 1 | xargs basename)
          echo "Building for version: $LATEST_VERSION_DIR"
          node scripts/build.js $LATEST_VERSION_DIR

      # --- æ–°å¢çš„å…³é”®æ­¥éª¤ ---
      - name: Prepare files for deployment ğŸ“¦
        run: |
          # å°†åŒ…å« _index.md çš„æ•´ä¸ª cases ç›®å½•å¤åˆ¶åˆ° docs ç›®å½•ä¸‹
          # è¿™æ · docs/index.html å°±å¯ä»¥é€šè¿‡ç›¸å¯¹è·¯å¾„ ../cases/... è®¿é—®åˆ°å®ƒäº†
          # ä½†æ›´ç¨³å¦¥çš„åšæ³•æ˜¯ç›´æ¥å°† cases ç›®å½•å¤åˆ¶åˆ° docs å†…éƒ¨
          cp -r cases docs/
          
          # å°† results ç›®å½•ä¹Ÿå¤åˆ¶è¿‡å»ï¼Œä»¥ä¾¿å‰ç«¯èƒ½åŠ è½½åˆ°æµ‹è¯•ç»“æœ
          # æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„ results ç›®å½•ï¼Œä»¥é˜²å®ƒä¸å­˜åœ¨
          mkdir -p docs/results
          # å¦‚æœ results ç›®å½•å­˜åœ¨äºä¸»åˆ†æ”¯ï¼Œåˆ™å¤åˆ¶å®ƒ
          if [ -d "results" ]; then
            cp -r results/* docs/results/
          fi
          
          echo "Deployment directory structure:"
          ls -R docs/

      - name: Deploy to GitHub Pages ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: docs # ç°åœ¨ docs ç›®å½•åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„æ–‡ä»¶